<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>P√°gina de Sorteos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  min-height:100vh;
  background: linear-gradient(
    135deg,
    #ff0000,
    #ff7f00,
    #ffff00,
    #00ff00,
    #00ffff,
    #0000ff,
    #8b00ff
  );
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Arial,sans-serif;
}

.app{
  width:380px;
  max-width:95%;
  background: rgba(0,0,0,0.7);
  border-radius:25px;
  padding:20px 15px 25px;
  box-shadow:0 0 40px rgba(0,0,0,.7);
  text-align:center;
}

.titulo{
  font-size:1.6rem;
  font-weight:bold;
  margin-bottom:10px;
  color:#fff;
  text-shadow:0 0 10px rgba(255,255,255,.8);
}

/* PANEL CONTROL */
.panel{
  background:rgba(255,255,255,0.1);
  border-radius:12px;
  padding:10px;
  margin-bottom:12px;
}
.panel textarea,
.panel select{
  width:100%;
  margin:6px 0;
  padding:8px;
  border-radius:8px;
  border:none;
  font-size:14px;
}
.panel small{
  color:#ddd;
  font-size:12px;
}

.ruleta-container{
  position:relative;
  width:280px;
  height:280px;
  margin:15px auto 20px;
}

.flecha{
  position:absolute;
  top:-2px;
  left:50%;
  transform:translateX(-50%);
  width:0;
  height:0;
  border-left:14px solid transparent;
  border-right:14px solid transparent;
  border-top:24px solid #fff;
  z-index:10;
}

canvas{
  width:100%;
  height:100%;
  border-radius:50%;
  background:#fff;
}

button{
  width:85%;
  padding:14px;
  font-size:1.1rem;
  border-radius:30px;
  border:none;
  background:linear-gradient(45deg,#ff9f00,#ff6a00);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
  box-shadow:0 0 20px rgba(255,140,0,.6);
}

.resultado{
  margin-top:15px;
  font-size:1.3rem;
  color:#fff;
  text-shadow:0 0 10px rgba(255,255,255,.8);
}
</style>
</head>

<body>

<div class="app">

  <div class="titulo">P√ÅGINA DE SORTEOS</div>

  <!-- PANEL DE CONTROL -->
  <div class="panel">
    <textarea id="lista" rows="4" placeholder="Un nombre por l√≠nea"></textarea>
    <select id="ganador">
      <option value="">üé≤ Aleatorio</option>
    </select>
    <small>
      ‚Ä¢ Repet√≠ nombres para m√°s chances<br>
      ‚Ä¢ Si eleg√≠s ganador, sale ese
    </small>
  </div>

  <div class="ruleta-container">
    <div class="flecha"></div>
    <canvas id="ruleta" width="280" height="280"></canvas>
  </div>

  <button id="girar">GIRAR</button>
  <div id="resultado" class="resultado"></div>

</div>

<script>
const canvas = document.getElementById("ruleta");
const ctx = canvas.getContext("2d");
const lista = document.getElementById("lista");
const selectGanador = document.getElementById("ganador");
const boton = document.getElementById("girar");
const resultado = document.getElementById("resultado");

let participantes = [];
let anguloActual = 0;

function actualizar(){
  participantes = lista.value
    .split("\n")
    .map(n=>n.trim())
    .filter(n=>n);

  selectGanador.innerHTML = `<option value="">üé≤ Aleatorio</option>`;
  participantes.forEach((n,i)=>{
    const op = document.createElement("option");
    op.value = i;
    op.textContent = n;
    selectGanador.appendChild(op);
  });

  dibujarRuleta();
}

lista.addEventListener("input", actualizar);

function dibujarRuleta(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(participantes.length===0) return;

  const total = participantes.length;
  const radio = canvas.width/2;
  const ang = (2*Math.PI)/total;
  const colores = ["#ff595e","#ffca3a","#8ac926","#1982c4","#6a4c93"];

  participantes.forEach((n,i)=>{
    ctx.beginPath();
    ctx.moveTo(radio,radio);
    ctx.arc(radio,radio,radio,i*ang,(i+1)*ang);
    ctx.fillStyle = colores[i%colores.length];
    ctx.fill();

    ctx.save();
    ctx.translate(radio,radio);
    ctx.rotate(i*ang+ang/2);
    ctx.textAlign="right";
    ctx.fillStyle="#fff";
    ctx.font="bold 12px Arial";
    ctx.fillText(n, radio-10, 4);
    ctx.restore();
  });
}

boton.addEventListener("click",()=>{
  if(participantes.length<2) return alert("Carg√° al menos 2 nombres");

  const total = participantes.length;
  const grados = 360/total;

  let indice;
  if(selectGanador.value!==""){
    indice = parseInt(selectGanador.value);
  }else{
    indice = Math.floor(Math.random()*total);
  }

  const objetivo = 270 - (indice*grados + grados/2);
  const vueltas = 6*360;
  const anguloFinal = vueltas + objetivo;

  const inicio = performance.now();
  const duracion = 5000;
  const inicioAng = anguloActual;

  function animar(t){
    const p = Math.min((t-inicio)/duracion,1);
    anguloActual = inicioAng + (anguloFinal-inicioAng)*(1-Math.pow(1-p,3));

    ctx.save();
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.translate(canvas.width/2,canvas.height/2);
    ctx.rotate(anguloActual*Math.PI/180);
    ctx.translate(-canvas.width/2,-canvas.height/2);
    dibujarRuleta();
    ctx.restore();

    if(p<1){
      requestAnimationFrame(animar);
    }else{
      resultado.textContent = `üéâ GANADOR: ${participantes[indice]}`;
    }
  }

  requestAnimationFrame(animar);
});
</script>

</body>
</html>
